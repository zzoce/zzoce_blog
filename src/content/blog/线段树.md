---
title: "çº¿æ®µæ ‘"
description: "çº¿æ®µæ ‘æ¨¡æ¿ï¼Œåˆ†è£‚åˆå¹¶ï¼ŒåŠ¨æ€å¼€åº—ï¼Œå¯æŒä¹…åŒ–ç­‰ç­‰"
pubDate: Oct 03 2024
image: /image/index.webp
categories:
  - ç®—æ³•
tags:
  - æ•°æ®ç»“æ„
  - çº¿æ®µæ ‘
badge: zzcoe
---


# çº¿æ®µæ ‘æ¨¡æ¿
[ã€AgOHã®æ•°æ®ç»“æ„ã€‘çº¿æ®µæ ‘åˆ†è£‚åˆå¹¶_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1f54y1E7e6/)
çº¿æ®µæ ‘æ˜¯ä¸€ç§å¯ä»¥ç»´æŠ¤æ»¡è¶³ç»“åˆå¾‹çš„åŒºé—´ä¿¡æ¯çš„æ•°æ®ç»“æ„
![Pasted image 20240225004219](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240225004219.png)

[P3372 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3372)
[P3374 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3374)
```cpp
#include <cstring>
#include <iostream>
#include <algorithm>
using namespace std;
#define N 100005
#define LL long long
#define lc u<<1
#define rc u<<1|1
LL w[N];
struct Tree{ //çº¿æ®µæ ‘
    LL l,r,sum,add;
}tr[N*4];

void pushup(LL u){ //ä¸Šä¼ 
    tr[u].sum=tr[lc].sum+tr[rc].sum;
}
void pushdown(LL u){ //ä¸‹ä¼ 
    if(tr[u].add){//lazyæ ‡è¯†ä¸ä¸ºé›¶
        //ä¸‹æ”¾ç»™ä¸¤ä¸ªå„¿å­
        tr[lc].sum+=tr[u].add*(tr[lc].r-tr[lc].l+1),
        tr[rc].sum+=tr[u].add*(tr[rc].r-tr[rc].l+1),
        tr[lc].add+=tr[u].add,
        tr[rc].add+=tr[u].add,
        //lazyè¡¨ç¤ºç½®é›¶
        tr[u].add=0;
    }
}
void build(LL u,LL l,LL r){ //å»ºæ ‘ï¼Œä¿¡æ¯éƒ½åœ¨å¶å­ç»“ç‚¹ä¸Š
    tr[u]={l,r,w[l],0};
    if(l==r) return;
    LL m=l+r>>1;
    build(lc,l,m);
    build(rc,m+1,r);
    pushup(u);
}
void updata(int u, int x, int k){//ç‚¹ä¿®æ”¹
    if (tr[u].l == x && tr[u].r == x){//å¶å­ç»“ç‚¹ä¿®æ”¹
        tr[u].sum+=k;
        return ;
    }
    int m= tr[u].l + tr[u].r >> 1;//éå¶å­ç»“ç‚¹åˆ™è£‚å¼€
    if (x<=m) updata(lc,x,k);
    if (x>m) updata(rc,x,k);
    tr[u].sum= tr[lc].sum + tr[rc].sum;
}

void change(LL u,LL l,LL r,LL k){ //åŒºä¿®
    if(l<=tr[u].l&&tr[u].r<=r){
        tr[u].sum+=(tr[u].r-tr[u].l+1)*k;
        tr[u].add+=k;
        return;
    }
    LL m=tr[u].l+tr[u].r>>1;
    pushdown(u);
    if(l<=m) change(lc,l,r,k);
    if(r>m) change(rc,l,r,k);
    pushup(u);
}
LL query(LL u,LL l,LL r){ //åŒºæŸ¥
    if(l<=tr[u].l && tr[u].r<=r) return tr[u].sum;
    LL m=tr[u].l+tr[u].r>>1;
    pushdown(u);
    LL sum=0;
    if(l<=m) sum+=query(lc,l,r);
    if(r>m) sum+=query(rc,l,r);
    return sum;
}
int main(){
    int n,m,op,x,y,k;
    cin>>n>>m;
    for(int i=1; i<=n; i ++) cin>>w[i];

    build(1,1,n);
    while(m--){
        cin>>op>>x>>y;
        if(op==2)cout<<query(1,x,y)<<endl;
        else cin>>k,change(1,x,y,k);
    }
    return 0;
}
```



####  **ä¾‹é¢˜ä¸€**
[Queue - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/CF91B)
é¢˜ç›®å¤§æ„ï¼š
ç»™å®š `n` ä¸ªæ­£æ•´æ•° $a_1â€¦_n$ã€‚éœ€è¦è¾“å‡ºä¸€ä¸ª `n` ä¸ªæ•°ï¼Œè®¾æ­¤æ—¶æ­£åœ¨å¤„ç†ç¬¬ `i` ä¸ªæ•°ï¼š
    - è®¾ $a_j < a_i,j > i$ã€‚
    - åœ¨æ»¡è¶³ç¬¬ä¸€æ¡çš„åŸºç¡€ä¸Šä½¿ `j-i-1` å°½å¯èƒ½å¤§ï¼Œæ­¤æ—¶ ` j - i - 1` å³ä¸ºç­”æ¡ˆã€‚
$2 \leq n \leq 10^5ï¼Œa_i \leq 10^9$, å¦‚æœå¯¹äºæŸä¸ª `i`ï¼Œä¸å­˜åœ¨ä»»ä½•ä¸€ä¸ª `j` æ»¡è¶³ $a_j < a_i$ ä¸” $j > i$ï¼Œåˆ™è¾“å‡º `-1`ã€‚

**å³æ‰¾æœ€è¿œå°äº `a[i]` çš„å€¼çš„ä½ç½®**

```cpp
#include<iostream>
#include <queue>
#include <cstring>
#define ll long long
#define lc u<<1
#define rc u<<1|1
using namespace std;
const ll maxn=1e5+5;
ll w[maxn];
struct tree{
	ll l,r,minsum,add;
}tr[maxn*4];

void updata(ll u){//å‘ä¸Šä¿®æ”¹ç»´æŠ¤çº¿æ®µæ ‘
	tr[u].minsum=min(tr[lc].minsum,tr[rc].minsum);
} 
void build(ll u,ll l,ll r){//å»ºæ ‘
	tr[u]={l,r,w[l],0};
	if (l==r){
		return ;
	} 
	ll m=l+r>>1;
	build(lc,l,m);
	build(rc,m+1,r);
	updata(u);
}
ll diancha(ll u,ll k){//ç‚¹æŸ¥
	ll t=-1;
	if (tr[u].l==tr[u].r){
		if (tr[u].minsum<k){
			return tr[u].l;
		}
		return -1;
	}

	if (tr[u].minsum<k){
		if(tr[rc].minsum<k){//å› ä¸ºè¦æ‰¾å°äºkçš„æœ€è¿œå€¼ï¼Œæ‰€ä»¥å…ˆè€ƒè™‘å³è¾¹çš„
		//å³è¾¹çš„æœ€å°å€¼å°äºkåˆ™ä¸å¿…å†è€ƒè™‘å·¦è¾¹çš„
			t=max(t,diancha(rc,k));
		} else if (tr[lc].minsum<k){
			t=max(t,diancha(lc,k));
		}
	}
	
	return t;
}
int main (){
	int n;
	cin>>n;
	for (int i=1;i<=n;i++)
	{
		cin>>w[i];
	}
	build (1,1,n);
	
	for (int i=1;i<=n;i++)
	{
		ll t = diancha(1,w[i]);
		if (t<=i){
			cout<<"-1 ";
		}else {
			cout<<t-i-1<<" ";
		}
		
	}
	return 0;
} 
```


#### ä¾‹é¢˜å››
[P3373 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 2 - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3373)
ä¸€ä¸ªçº¿æ®µæ ‘ä¸ŠåŒæ—¶è¿›è¡Œä¸¤ç§æ“ä½œåŒºé—´ä¹˜ä»¥åŠåŒºé—´åŠ 
**ä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>

#define MAXN 100010
#define ll long long

using namespace std;

int n, m, mod;
int a[MAXN];

struct Segment_Tree {
	ll sum, add, mul;
	int l, r;
}s[MAXN * 4];

void update(int pos) {
	s[pos].sum = (s[pos << 1].sum + s[pos << 1 | 1].sum) % mod;
    return;
}

void pushdown(int pos) { //pushdownçš„ç»´æŠ¤
	S[pos << 1]. Sum = (s[pos << 1]. Sum * s[pos]. Mul + s[pos]. Add * (s[pos << 1]. R - s[pos << 1]. L + 1)) % mod;
	S[pos << 1 | 1]. Sum = (s[pos << 1 | 1]. Sum * s[pos]. Mul + s[pos]. Add * (s[pos << 1 | 1]. R - s[pos << 1 | 1]. L + 1)) % mod;
	
	S[pos << 1]. Mul = (s[pos << 1]. Mul * s[pos]. Mul) % mod;
	S[pos << 1 | 1]. Mul = (s[pos << 1 | 1]. Mul * s[pos]. Mul) % mod;
	
	S[pos << 1]. Add = (s[pos << 1]. Add * s[pos]. Mul + s[pos]. Add) % mod;
	S[pos << 1 | 1]. Add = (s[pos << 1 | 1]. Add * s[pos]. Mul + s[pos]. Add) % mod;
		
	S[pos]. Add = 0;
	S[pos]. Mul = 1;
	Return; 
}

Void build_tree (int pos, int l, int r) { //å»ºæ ‘
	S[pos]. L = l;
	S[pos]. R = r;
	S[pos]. Mul = 1;
	
	If (l == r) {
		S[pos]. Sum = a[l] % mod;
		Return;
	}
	
	Int mid = (l + r) >> 1;
	Build_tree (pos << 1, l, mid);
	Build_tree (pos << 1 | 1, mid + 1, r);
	Update (pos);
	Return;
}

Void ChangeMul (int pos, int x, int y, int k, int t) { 
	If (x <= s[pos]. L && s[pos]. R <= y) {
		If (t==2){
			S[pos]. Add = (s[pos]. Add + k) % mod;
			S[pos]. Sum = (s[pos]. Sum + k * (s[pos]. R - s[pos]. L + 1)) % mod;
		}else if (t==1){
			S[pos]. Add = (s[pos]. Add * k) % mod;
			S[pos]. Mul = (s[pos]. Mul * k) % mod;
			S[pos]. Sum = (s[pos]. Sum * k) % mod;
		}
		
		Return;
	}
	
	Pushdown (pos);
	Int mid = (s[pos]. L + s[pos]. R) >> 1;
	If (x <= mid) ChangeMul (pos << 1, x, y, k, t);
	If (y > mid) ChangeMul (pos << 1 | 1, x, y, k, t);
	Update (pos);
	Return;
}

Ll AskRange (int pos, int x, int y) { //åŒºé—´è¯¢é—®
	If (x <= s[pos]. L && s[pos]. R <= y) {
		Return s[pos]. Sum;
	}
	
	Pushdown (pos);
	Ll val = 0;
	Int mid = (s[pos]. L + s[pos]. R) >> 1;
	If (x <= mid) val = (val + AskRange (pos << 1, x, y)) % mod;
	If (y > mid) val = (val + AskRange (pos << 1 | 1, x, y)) % mod;
	Return val;
}

Int main () {
	Scanf ("%d%d", &n, &mod);
	
	For (int i = 1; i <= n; i++) {
		Scanf ("%d", &a[i]);
	}
	
	Build_tree (1, 1, n);
	Cin>>m;
	For (int i = 1; i <= m; i++) {
		Int opt, x, y;
		Scanf ("%d%d%d", &opt, &x, &y);
		If (opt == 3) {
			Printf ("%lld\n", AskRange (1, x, y));
		}else {
			Int k;
			Scanf ("%d", &k);
			ChangeMul (1, x, y, k, opt);
		}
	}
    
	Return 0;
}
```


####  ä¾‹é¢˜ä¸‰
[P 3740 [HAOI 2014] è´´æµ·æŠ¥ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu. Com. Cn)](https://www.luogu.com.cn/problem/P3740)
ä¸éœ€è¦å»ºæ ‘çš„çº¿æ®µæ ‘ï¼Œæ¯ä¸€æ­¥å¤§æ“ä½œéƒ½æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¸”æ ‘ä¸Šåªå­˜å‚¨å°‘é‡çš„ä¿¡æ¯ï¼Œåœ¨ä¸å»ºæ ‘çš„æƒ…å†µä¸‹å¯ä»¥èŠ‚çœå¾ˆå¤šç©ºé—´å¤æ‚åº¦

**è§£é¢˜æ€è·¯**ï¼š
 çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æ˜¯å¦è¢«æŸ“è‰²ï¼šåŒºé—´ä¿®æ”¹æ²¡è¢«æŸ“è‰²çš„ç‚¹ï¼Œæ ‡è®°ï¼Œ`++ans`ï¼›å¦‚æœåŒºé—´çš„ç‚¹å…¨è¢«æŸ“è¿‡è‰²ï¼Œé‚£`ans`ä¸å˜ã€‚
 **æ³¨æ„**æ•°æ®çš„å¤„ç†é¡ºåºä¸è¾“å…¥é¡ºåºç›¸åã€‚å› ä¸ºæœ€åè¾“å…¥çš„åœ¨æœ€ä¸Šé¢ï¼Œä¸€å®šå¯ä»¥`ans++`ï¼Œæ‰€ä»¥å…ˆå¤„ç†ï¼Œä¹‹åå¤„ç†å…ˆè¾“å…¥çš„æ•°æ®ï¼Œå¦‚æœå®ƒéœ€è¦çš„åŒºé—´å·²ç»è¢«æ ‡è®°åˆ™è¡¨ç¤ºå®ƒè¢«åè¾“å…¥çš„è¦†ç›–äº†ï¼Œäºæ˜¯ä¸èƒ½`ans++`ï¼Œç›´æ¥`return`ã€‚å¯ä»¥ç»“åˆä»£ç åœ¨ä»”ç»†ç†è§£

**ä»£ç **ï¼š
```cpp
#include <iostream>
#include <algorithm>
#include <cstring>
#include <set>
#define ll long long
#define lc u<<1
#define rc u<<1|1 
Using namespace std;
Const int maxn=1 e 7+5;
Bool vis[maxn<<2];
Bool flag;
Int read ()
{
    Int now=0; char c=getchar ();
    while (c<'0'||c>'9') c=getchar ();
    While (c>='0'&&c<='9') now=(now<<3)+(now<<1)+c-'0', c=getchar ();
    Return now;
}
Void updata (int u){
	Vis[u]=vis[lc]&&vis[rc];
}
Void Modify (int u, int l, int r, int L, int R){
	If (vis[u]){
		Return ;
	}
	if (L<=l&&R>=r){
		Flag=true;
		Vis[u]=true;
		Return ;
	}
	Int m=(l+r)>>1;
	If (L<=m){
		Modify (lc, l, m, L, R);
	}
	If (R>m){
		Modify (rc, m+1, r, L, R);
	}
	Updata (u);
	Return ;
} 
Int main ()
{
	Int n, m;
	Cin>>n>>m;
	Int a[1005], b[1005];
	For (int i=m; i>=1; i--){
		Cin>>a[i]>>b[i];
	}
	Int ans=0;
	For (int i=1; i<=m; i++){
		Flag=false;
		Modify (1,1, n, a[i], b[i]);
		If (flag){
			Ans++;
		}
	}
	Cout<<ans<<endl;
	Return 0;
}
```

# çº¿æ®µæ ‘åˆ†è£‚åˆå¹¶

[P 4556 [Vani æœ‰çº¦ä¼š]é›¨å¤©çš„å°¾å·´ /ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘åˆå¹¶_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1f54y1E7e6/?p=3)
#### ä¾‹é¢˜
[P5494 ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘åˆ†è£‚ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P5494)

**é¢˜æ„æè¿°**ï¼š
ç»™å‡ºä¸€ä¸ªå¯é‡é›†Â ğ‘ï¼ˆç¼–å·ä¸ºÂ 1ï¼‰ï¼Œå®ƒæ”¯æŒä»¥ä¸‹æ“ä½œï¼š

`0 p x y`ï¼šå°†å¯é‡é›†Â ğ‘Â ä¸­å¤§äºç­‰äºÂ ğ‘¥ä¸”å°äºç­‰äºÂ ğ‘¦Â çš„å€¼ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„å¯é‡é›†ä¸­ï¼ˆæ–°å¯é‡é›†ç¼–å·ä¸ºä»Â 2Â å¼€å§‹çš„æ­£æ•´æ•°ï¼Œæ˜¯ä¸Šä¸€æ¬¡äº§ç”Ÿçš„æ–°å¯é‡é›†çš„ç¼–å·+1ï¼‰ã€‚

`1 p t`ï¼šå°†å¯é‡é›†Â ğ‘¡tÂ ä¸­çš„æ•°æ”¾å…¥å¯é‡é›†Â ğ‘ï¼Œä¸”æ¸…ç©ºå¯é‡é›†Â ğ‘¡ï¼ˆæ•°æ®ä¿è¯åœ¨æ­¤åçš„æ“ä½œä¸­ä¸ä¼šå‡ºç°å¯é‡é›†Â ğ‘¡ï¼‰ã€‚

`2 p x q`ï¼šåœ¨Â ğ‘è¿™ä¸ªå¯é‡é›†ä¸­åŠ å…¥Â ğ‘¥Â ä¸ªæ•°å­—Â ğ‘ã€‚//ä¹Ÿå°±æ˜¯ r=l=qï¼Œval+=xï¼›

`3 p x y`ï¼šæŸ¥è¯¢å¯é‡é›†Â ğ‘Â ä¸­å¤§äºç­‰äºÂ ğ‘¥xÂ ä¸”å°äºç­‰äºÂ ğ‘¦Â çš„å€¼çš„ä¸ªæ•°ã€‚

`4 p k`ï¼šæŸ¥è¯¢åœ¨Â ğ‘Â è¿™ä¸ªå¯é‡é›†ä¸­ç¬¬Â ğ‘˜Â å°çš„æ•°ï¼Œä¸å­˜åœ¨æ—¶è¾“å‡ºÂ `-1`ã€‚

**è¾“å…¥æ ¼å¼**

ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•°Â ğ‘›,ğ‘šn, mï¼Œè¡¨ç¤ºå¯é‡é›†ä¸­çš„æ•°åœ¨Â 1âˆ¼ğ‘›1âˆ¼nÂ çš„èŒƒå›´å†…ï¼Œæœ‰Â ğ‘šmÂ ä¸ªæ“ä½œã€‚

æ¥ä¸‹æ¥ä¸€è¡ŒÂ ğ‘›nÂ ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºÂ 1âˆ¼ğ‘›1âˆ¼nÂ è¿™äº›æ•°åœ¨Â ğ‘aÂ ä¸­å‡ºç°çš„æ¬¡æ•°Â (ğ‘ğ‘–â‰¤ğ‘š)(aiâ€‹â‰¤m)ã€‚

æ¥ä¸‹æ¥çš„Â ğ‘šmÂ è¡Œæ¯è¡Œè‹¥å¹²ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªæ•°ä¸ºæ“ä½œçš„ç¼–å·Â ğ‘œğ‘ğ‘¡optï¼ˆ0â‰¤ğ‘œğ‘ğ‘¡â‰¤40â‰¤optâ‰¤4ï¼‰ï¼Œä»¥**é¢˜ç›®æè¿°**ä¸ºå‡†ã€‚

**è¾“å‡ºæ ¼å¼**

ä¾æ¬¡è¾“å‡ºæ¯ä¸ªæŸ¥è¯¢æ“ä½œçš„ç­”æ¡ˆã€‚

```cpp
#include <iostream>
#include <cstdio>
#include <ctime>
Using namespace std;
//==========================================
Const int maxn = 2 e 5 + 5;
Typedef long long ll;
Struct Node
{
    Int l, r;//è¡¨ç¤ºå·¦å³åŒºé—´
    Ll val;//è¡¨ç¤ºå…ƒç´ ä¸ªæ•°
}sgt[maxn*40];      //? 40 = 2*maxm*log 2 (maxn)ï¼Œç›¸å½“äºä¸€ä¸ªè¶…å¤§çš„çº¿æ®µæ ‘ï¼Œå¯æ‹†åˆ†
Int cnt, root[maxn];//æŒ‡å‘çº¿æ®µæ ‘çš„æ ¹ï¼Œè¡¨ç¤ºä¸ºä¸€ä¸ªæ–°çš„çº¿æ®µæ ‘

Inline void pushup (int k) { sgt[k]. Val = sgt[sgt[k]. L]. Val + sgt[sgt[k]. R]. Val; }
Void modify (int l, int r, int &k, int p, int x)     // å•ç‚¹ä¿®æ”¹: p ä½ç½®çš„å€¼åŠ ä¸Š xï¼Œç©ºé—´å¤æ‚åº¦ O (logn)
{
    If (! K) k=++cnt;     // å¦‚æœåˆ°äº† NIL ç»“ç‚¹å°±æ–°å»ºä¸€ä¸ª
    Sgt[k]. Val += x;    // å•ç‚¹ä¿®æ”¹çš„åŠ æ³•ç›´æ¥ä¸€æ¡çº¿ä¸Šå…¨éƒ¨åŠ ä¸Š x å³å¯
    If (l==r) return;
    Int m = (l+r)>>1;
    If (p<=m) modify (l, m, sgt[k]. L, p, x);      // åœ¨å·¦å­æ ‘
    Else modify (m+1, r, sgt[k]. R, p, x);        // åœ¨å³å­æ ‘
}
Void merge (int &x, int y)        // æŠŠ y ç»“ç‚¹çš„å†…å®¹åˆå¹¶åˆ° x ç»“ç‚¹ä¸Šï¼Œæ­¤å†™æ³•ä¸æ¶ˆè€—ç©ºé—´
{
    If (! (x&&y)) x|=y;           // å¦‚æœäºŒè€…æœ‰ NULL ç»“ç‚¹
    Else 
    {
        Sgt[x]. Val += sgt[y]. Val;   // ç»´æŠ¤åŠ æ³•ï¼Œç›´æ¥åŠ å°±æ˜¯äº†
        Merge (sgt[x]. L, sgt[y]. L);  // é€’å½’åˆå¹¶ä¸¤ç»“ç‚¹çš„å·¦å­æ ‘
        Merge (sgt[x]. R, sgt[y]. R);  // é€’å½’åˆå¹¶ä¸¤ç»“ç‚¹çš„å³å­æ ‘
    }
}
Int split (int l, int r, int &k, int x, int y)   // ä» k ä¸­åˆ†ç¦»å‡º[x, y]åŒºé—´å¹¶è¿”å›æ–°ç»“ç‚¹ç¼–å·ï¼Œç©ºé—´å¤æ‚åº¦ O (2 logn)
{
    Int n = ++cnt;
    if (x<=l&&y>=r)      // å¦‚æœ k ç»“ç‚¹ç»´æŠ¤çš„åŒºé—´åœ¨[x, y]ä¸­
    {
        Sgt[n] = sgt[k];    // ç›´æ¥æ‹¿è¿‡æ¥ä¾¿æ˜¯
        K = 0;              // ç½®ä¸º NULLï¼Œæ–­æ‰è”ç³»
    }
    Else 
    {
        Int m = (l+r)>>1;
        If (x<=m) sgt[n]. L = split (l, m, sgt[k]. L, x, y);        // è‹¥å·¦å­æ ‘ä¸­æœ‰åŒºé—´ä¿¡æ¯
        If (y>m)  sgt[n]. R = split (m+1, r, sgt[k]. R, x, y);      // è‹¥å³å­æ ‘ä¸­æœ‰åŒºé—´ä¿¡æ¯
        Pushup (k);
        Pushup (n);      // æ›´æ”¹åè®°å¾—æ›´æ–°å€¼
    }
    Return n;
}
Ll query (int l, int r, int k, int x, int y)     // åŒºé—´æŸ¥è¯¢
{
    if (x<=l&&y>=r) return sgt[k]. Val;
    Int m = (l+r)>>1;
    Ll sum = 0;
    If (x<=m) sum += query (l, m, sgt[k]. L, x, y);
    If (y>m)  sum += query (m+1, r, sgt[k]. R, x, y);
    Return sum;
}
Ll query (int l, int r, int k, int kth)         // å•ç‚¹æŸ¥è¯¢
{
    If (l==r) return l;
    Int m = (l+r)>>1;
    If (kth<=sgt[sgt[k]. L]. Val) return query (l, m, sgt[k]. L, kth);
    Else return query (m+1, r, sgt[k]. R, kth-sgt[sgt[k]. L]. Val);
}
Signed main (signed argc, char const *argv[])
{
    Clock_t c 1 = clock ();
#ifdef LOCAL
    Freopen ("in. In", "r", stdin);
    Freopen ("out. Out", "w", stdout);
#endif
    //======================================
    Int n, m;
    Cin>>n>>m;
    For (int i=1; i<=n; i++)
    {
        Int x;
        Cin>>x;
        Modify (1, n, root[1], i, x);            // åˆå§‹çŠ¶æ€ä¸‹å€¼éƒ½ä¸º 0ï¼Œæ‰€ä»¥åŠ  x å³ä¸ºç½®ä¸º x
    }
    Int last = 1;
    While (m--)
    {
        Int opt, x, y, z;
        Cin>>opt>>x>>y;
        Switch (opt)
        {
        Case 0:
            Cin>>z;
            Root[++last] = split (1, n, root[x], y, z);
            Break;
        Case 1:
            Merge (root[x], root[y]);
            Break;
        Case 2:
            Cin>>z;
            Modify (1, n, root[x], z, y);
            Break;
        Case 3:
            Cin>>z;
            Cout<<query (1, n, root[x], y, z)<<endl;
            Break;
        Case 4:
            If (y>sgt[root[x]]. Val) cout<<-1<<endl;      // è‹¥åªæœ‰ 4 ä¸ªå…ƒç´ å´æ¥æŸ¥è¯¢ç¬¬ 5 å¤§å…ƒç´ ï¼ˆä¾‹å¦‚ï¼‰ï¼Œé‚£ä¹ˆç»“æœå³ä¸º-1
            Else cout<<query (1, n, root[x], y)<<endl;
            Break;
        }
    }
    //======================================
End:
    Cerr << "Time Used: " << clock () - c 1 << "ms" << endl;
    Return 0;
}
```

# åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘

[C48 çº¿æ®µæ ‘+åŠ¨æ€å¼€ç‚¹ CF915E Physical Education Lessons_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1Uh4y1i7hm/)

![Pasted image 20240503205623|1224](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240503205623.png)
![Pasted image 20240504172239](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504172239.png)

#### æ¨¡æ¿é¢˜
[Physical Education Lessons - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/CF915E)

æ—¶é—´è¶…æ—¶ï¼Œä½†é€»è¾‘æ­£ç¡®å¯å‚è€ƒå­¦ä¹ 

```cpp
#include <iostream>
#define ll long long
#define lc tr[u]. L
#define rc tr[u]. R
Using namespace std;
Const int MAXN=3 e 5+5;
Int tot=1;
Struct node {
    Int l, r, num, tag;
}tr[MAXN*50];
Void pushup (int u){
    Tr[u]. Num=tr[lc]. Num+tr[rc]. Num;
}
Void pushdown (int u, int l, int r){
    If (tr[u]. Tag==0){
        Return ;
    }
    Int m=(l+r)>>1;
    //å¼€ç‚¹
    If (! Tr[u]. L) tr[u]. L=++tot;
    If (! Tr[u]. R) tr[u]. R=++tot;
    If (tr[u]. Tag==1)//éå·¥ä½œæ—¥
    {
        Tr[lc]. Num=m-l+1;
        Tr[rc]. Num=r-m;
    }else if (tr[u]. Tag==2){//å·¥ä½œæ—¥
        Tr[lc]. Num=tr[rc]. Num=0;
    }
    Tr[lc]. Tag=tr[rc]. Tag=tr[u]. Tag;
    Tr[u]. Tag=0;
}
Void change (int &u, int l, int r, int x, int y, int tag){//u å¿…é¡»ä¸ºå¼•ç”¨
	//å¼€ç‚¹
    If (! U){//å› ä¸ºæ­¤å¤„ä¼šå¯¹ u ä¿®æ”¹
        U=++tot;//å¦‚æœä¸æ˜¯å¼•ç”¨ï¼Œåˆ™ u çš„å·¦å³å­æ ‘æ°¸è¿œæŒ‡å‘ 0
    }
    if (x<=l&&y>=r){
        If (tag==1){
            Tr[u]. Num=r-l+1;
        }else {
            Tr[u]. Num=0;
        }
        Tr[u]. Tag=tag;
        Return ;
    }
    Pushdown (u, l, r);
    Int m=(l+r)>>1;
    If (x<=m){
        Change (lc, l, m, x, y, tag);
    }
    If (y>m){
        Change (rc, m+1, r, x, y, tag);
    }
    Pushup (u);

}
Int main ()
{
    Int n, m, root=1;
    Cin>>n>>m;
    Int opt, l, r;
    For (int i=1; i<=m; i++){
        Cin>>l>>r>>opt;
        Change (root, 1, n, l, r, opt);
        Cout<<n-tr[root]. Num<<endl;
    }
    Return 0;
}
```

#### é¢˜äºŒï¼š
[T125847 ã€æ¨¡æ¿ã€‘åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/T125847)


#### é¢˜ä¸‰ï¼š
[P 3960 [NOIP 2017 æé«˜ç»„] åˆ—é˜Ÿ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu. Com. Cn)](https://www.luogu.com.cn/problem/P3960)


# å¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼ˆä¸»å¸­æ ‘ï¼‰

[C49ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼ˆä¸»å¸­æ ‘ï¼‰P3919 å¯æŒä¹…åŒ–æ•°ç»„_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV11H4y167rp/)

## ç†è®º
![Pasted image 20240504172813](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504172813.png)
## å®ç°

#### å»ºæ ‘
![Pasted image 20240504173258](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504173258.png)
#### ç‚¹ä¿®
![Pasted image 20240504174024](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504174024.png)

#### ç‚¹æŸ¥

![Pasted image 20240504174145](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504174145.png)

## ä»£ç å®ç°

#### ä¾‹é¢˜ï¼š
[P3919 ã€æ¨¡æ¿ã€‘å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 1ï¼ˆå¯æŒä¹…åŒ–æ•°ç»„ï¼‰ - æ´›è°· | è®¡ç®—æœºç§‘å­¦æ•™è‚²æ–°ç”Ÿæ€ (luogu.com.cn)](https://www.luogu.com.cn/problem/P3919)

```cpp
#include <iostream>
#define ll long long
Using namespace std;
Const int MAXN=1 e 6+5;
Int root[MAXN], tot;
Int a[MAXN];
Struct node {
    Int l, r, num;
}tr[MAXN*25];
Void build (int &u, int l ,int r){//å»ºæ ‘
    U=++tot;
    If (l==r){
        Tr[u]. Num=a[l];
        Return ;
    }
    Int m=(l+r)>>1;
    Build (tr[u]. L, l, m);
    Build (tr[u]. R, m+1, r);
}
Void change (int &u, int v, int l, int r, int p, int num){//ç‚¹ä¿®
    U=++tot;
    Tr[u]=tr[v];
    If (l==r){
        Tr[u]. Num=num;
        Return ;
    }
    Int m=(l+r)>>1;
    If (p<=m){
        Change (tr[u]. L, tr[v]. L, l, m, p, num);
    }else {
        Change (tr[u]. R, tr[v]. R, m+1, r, p, num);
    }
    Return ;
}
Int query (int u, int l, int r, int p){//ç‚¹æŸ¥
   If (l==r){
       Return tr[u]. Num;
   }
   Int m=(l+r)>>1;
   If (p<=m){
      Return  query (tr[u]. L, l, m, p);
   }else {
      Return  query (tr[u]. R, m+1, r, p);
   }
}
Int main ()
{
    Int n, m;
    Cin>>n>>m;
    For (int i=1; i<=n; i++){
        Scanf ("%d",&a[i]);
//        cin>>a[i];
    }
    Build (root[0], 1, n);

    For (int i=1; i<=m; i++){
        Int u, opt, x, num;
        Scanf ("%d %d %d",&u,&opt,&x);
//        cin>>u>>opt>>x;
        If (opt==1){
            Scanf ("%d",&num);
//            cin>>num;
            Change (root[i], root[u], 1, n, x, num);
        }else {
            Root[i]=root [u];
            Cout<<query (root[u], 1, n, x)<<endl;
        }
    }
    Return 0;
}

```


# çº¿æ®µæ ‘æ ‡è®°æ°¸ä¹…åŒ–

***æ ‡è®°æ°¸ä¹…åŒ–***ï¼šå°±æ˜¯ä¿®æ”¹æ—¶ç•™ä¸‹çš„æ‡’æ ‡è®°å¹¶ä¸ä¸‹ç©¿ï¼Œä¹Ÿä¸åˆ é™¤ï¼Œè€Œæ˜¯ç•™åœ¨æ‰“ä¸Šæ ‡è®°çš„é‚£ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å½“æŸ¥è¯¢ç»è¿‡è¿™ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°±åŠ ä¸Šè¿™ä¸ªèŠ‚ç‚¹çš„æ‡’æ ‡è®°é€ æˆçš„å½±å“ã€‚

***å› æ­¤***ï¼šæ ‡è®°æ°¸ä¹…åŒ–ä¸éœ€è¦ pushdown ä»¥åŠ pushup æ“ä½œï¼Œå¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„è®¡ç®—ï¼Œæ¥èŠ‚çœæ—¶é—´

![Pasted image 20240504220148](https://zzoce.obs.cn-north-4.myhuaweicloud.com/img/Pasted%20image%2020240504220148.png)

```cpp
#include <iostream>
#define ll long long
Using namespace std;
Const int MAXN=1 e 6+5;
Int root[MAXN], tot;
Int a[MAXN];
Struct node {
    Int l, r, num, tag;//åŒºé—´å’Œï¼Œæ°¸ä¹…æ ‡è®°
}tr[MAXN*25];
Void build (int u, int l, int r){
    Tr[u]. Num=a[l];
    If (l==r){
        Return ;
    }
    //lc=u>>1; rc=lc+1;
    Build (lc, l, m);
    Build (rc, m+1, r);
    Tr[u]. Num=tr[lc]. Num+tr[rc]. Num;
}
 Void change (int u, int l, int r, int x, int y, ll k){//åŒºä¿®
    Tr[u]. Num+=(min (r, y)-max (l, x)+1)*k;//ç»è¿‡èŠ‚ç‚¹æ›´æ–° num
    if (x<=l&&y>=r){//è¦†ç›–èŠ‚ç‚¹å°±æ›´æ–° tag
        Tr[u]. Tag+=k;
        Return ;
    }
    Int m=(l+r)>>1;
    If (x<=m){
        Change (lc, l, m, x, y, k);
    }
    If (y>m){
        Change (rc, m+1, r, x, y, k);
    }
}
 Ll query (int u, int l, int r, int x, int y, ll s){//åŒºæŸ¥ï¼Œs è·¯å¾„ä¸Š tag çš„ç´¯è®¡
    if (x<=l&&y>=r){//è¦†ç›–å°±è¿”å›
        Return tr[u]. Num+(min (r, y)-max (x, l)+1)*s;
    }
    Ll res=0;
    S+=tr[u]. Tag;//ç´¯è®¡ tagï¼Œå„¿å­è¦ç”¨
    Int m=(r+l)>>1;
    If (x<=m){
        Res+=query (lc, l, r, x, y, s);
    }
    If (y>m){
        Res+= query (rc, l, r, x, y, s);
    }
    Return res;
}
```

# çº¿æ®µæ ‘ç»´æŠ¤çŸ©é˜µä¹˜æ³•

çŸ©é˜µä¹˜æ³•æ»¡è¶³
	ç»“åˆå¾‹ï¼š(A\*B)\*C=A\*(B\*C)
	åˆ†é…å¾‹ï¼šA\*(B+C)=A\*B+A\*C

[çº¿æ®µæ ‘ç»´æŠ¤çŸ©é˜µ - untitled0 - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/untitled0/p/sgt-matrix.html)

# çº¿æ®µæ ‘ç»´æŠ¤å“ˆå¸Œ

[çº¿æ®µæ ‘ç»´æŠ¤å“ˆå¸Œ - zltzlt - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/zltzlt-blog/p/16797435.html)

